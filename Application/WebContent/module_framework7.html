<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8" />
        <title>Nosliw Go Go !!</title>

    	<link rel="stylesheet" href="libresources/external/framework7/css/framework7.bundle.min.css">
        <script src="libresources/external/jQuery/2.1.0/jquery.js"></script>
        <script src="libresources/external/framework7/4.1.1/framework7.js"></script>
        
        <script src="libresources/external/log4javascript/1.0.0/log4javascript.js"></script>
		<script src="libresources/nosliw/runtimebrowserinit/init.js"></script>

 		<meta name="viewport" content="width=device-width, initial-scale=1"> 

</head>

<body>
	<span id="states"></span></p>
	<span id="currentState"></span></p>
	<a id="startBtn">Start</a>
	<a id="restartBtn">Restart</a>
	<a id="suspendBtn">Suspend</a>
	<a id="resumeBtn">Resume</a>
	<p/>

	<div id="appDiv">
		<div class="view view-main" id="moduleDiv"></div>
	</div>
</body>

<script>

var moduleRuntime;

$(document).on("nosliwActive", function(){
	var node_createServiceRequestInfoSequence = nosliw.getNodeData("request.request.createServiceRequestInfoSequence");
	var node_requestServiceProcessor = nosliw.getNodeData("request.requestServiceProcessor");
	var node_COMMONCONSTANT = nosliw.getNodeData("constant.COMMONCONSTANT");
	var node_COMMONATRIBUTECONSTANT = nosliw.getNodeData("constant.COMMONATRIBUTECONSTANT");
	var node_getComponentLifecycleInterface = nosliw.getNodeData("component.getComponentLifecycleInterface");

    // Our initialization code here
	var currentSearchString = window.location.search;
	var parmValue = currentSearchString.substring(currentSearchString.indexOf("=")+1);
	var index = parmValue.indexOf(";");
	var moduleId = parmValue.substring(0, index);
	
	var moduleparms = parmValue.substring(index+1);
	index = moduleparms.indexOf(";");
	var moduleDecId = moduleparms.substring(0, index);
	var decoration = moduleparms.substring(index+1);
	
	//create module runtime
	var decorations = {};
	decorations[node_COMMONATRIBUTECONSTANT.DEFINITIONDECORATION_GLOBAL] = [decoration];
	var configure = {
		global : {
			root : $('#moduleDiv').get(),
			decoration : decorations,
			moduleDecoration : ["base", "uidecoration", moduleDecId],
			__storeService :{
				saveData : function(categary, id, data){
					localStorage.setItem(categary+"_"+id, JSON.stringify(data));
				},
				
				retrieveData : function(categary, id){
					return JSON.parse(localStorage.getItem(categary+"_"+id));
				},
				
				clearData : function(categary, id){
					return localStorage.removeItem(categary+"_"+id);
				}
			}
		},
		components : {
			application_framework7_mobile : {
				app : new Framework7({
					  // App root element
					  root: $("#appDiv").get(),
					  name: 'My App',
					  id: 'com.myapp.test',
				}),
			}
		}
	};
	nosliw.runtime.getUIModuleService().executeGetUIModuleRuntimeRequest(moduleId, moduleId, configure, undefined, {
		success : function(requestInfo, uiModuleRuntime){
			moduleRuntime = uiModuleRuntime;

			var lifecycle = node_getComponentLifecycleInterface(moduleRuntime);
			document.getElementById("currentState").innerHTML = lifecycle.getComponentStatus();
			document.getElementById("states").innerHTML = lifecycle.getComponentStatus();
			lifecycle.registerEventListener(undefined, function(eventName, eventData, request){
				if(eventName==node_CONSTANT.LIFECYCLE_RESOURCE_EVENT_FINISHTRANSITION){
					document.getElementById("states").innerHTML = document.getElementById("states").innerHTML + " -- " + lifecycle.getComponentStatus();
				}
				else if(eventName==node_CONSTANT.LIFECYCLE_RESOURCE_EVENT_FAILTRANSITION){
					document.getElementById("states").innerHTML = document.getElementById("states").innerHTML + " XX " + lifecycle.getComponentStatus();
				}
				else if(eventName==node_CONSTANT.LIFECYCLE_RESOURCE_EVENT_NOTRANSITION){
					document.getElementById("states").innerHTML = document.getElementById("states").innerHTML + " XX " + lifecycle.getComponentStatus();
				}
				document.getElementById("currentState").innerHTML = lifecycle.getComponentStatus();
			});

			
			document.getElementById("startBtn").addEventListener("click", function(event){
				var node_getComponentLifecycleInterface = nosliw.getNodeData("component.getComponentLifecycleInterface");
				event.preventDefault();
				node_getComponentLifecycleInterface(moduleRuntime).active();
			});

			document.getElementById("restartBtn").addEventListener("click", function(event){
				var node_getComponentLifecycleInterface = nosliw.getNodeData("component.getComponentLifecycleInterface");
				event.preventDefault();
				node_getComponentLifecycleInterface(moduleRuntime).restart();
			});

			document.getElementById("suspendBtn").addEventListener("click", function(event){
				var node_getComponentLifecycleInterface = nosliw.getNodeData("component.getComponentLifecycleInterface");
				event.preventDefault();
				node_getComponentLifecycleInterface(moduleRuntime).suspend();
			});

			document.getElementById("resumeBtn").addEventListener("click", function(event){
				var node_getComponentLifecycleInterface = nosliw.getNodeData("component.getComponentLifecycleInterface");
				event.preventDefault();
				node_getComponentLifecycleInterface(moduleRuntime).resume();
			});

			
		}
	});
});


nosliw.init();
</script>

</html>
