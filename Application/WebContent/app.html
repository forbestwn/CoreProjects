<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8" />
        <title>Nosliw Go Go !!</title>

    	<link rel="stylesheet" href="libresources/external/framework7/css/framework7.bundle.min.css">
        <script src="libresources/external/framework7/4.3.1/framework7.bundle.js"></script>
        <script src="libresources/external/jQuery/2.1.0/jquery.js"></script>
        
        <script src="libresources/external/log4javascript/1.0.0/log4javascript.js"></script>
		<script src="libresources/nosliw/runtimebrowserinit/init.js"></script>

		<meta name="viewport" content="width=device-width, initial-scale=1">

</head>

<body>

	<div id="appDiv">
		<div class="panel panel-left panel-cover">
      		<div class="block" id="userInfoDiv">
				<a id="appContext">AppContext</a><p>
				<a id="appModuleContext">appModuleContext</a><p>
				<a id="settingModuleContext">settingModuleContext</a><p>
				<textarea rows="15" cols="150" id="debug" style="resize: none;" data-role="none"></textarea>
         	</div>
    	</div>

		<div class="view view-main" id="appModuleDiv"></div>
		
		<div class="panel panel-right panel-cover">
      		<div class="block" id="settingModuleDiv"></div>
    	</div>
	</div>

</body>

<script>

$(document).on("nosliwActive", function(){
	var node_createServiceRequestInfoSequence = nosliw.getNodeData("request.request.createServiceRequestInfoSequence");
	var node_requestServiceProcessor = nosliw.getNodeData("request.requestServiceProcessor");
	var node_COMMONCONSTANT = nosliw.getNodeData("constant.COMMONCONSTANT");
	var node_COMMONATRIBUTECONSTANT = nosliw.getNodeData("constant.COMMONATRIBUTECONSTANT");
	var node_appDataService = nosliw.getNodeData("uiapp.appDataService");
	var node_getComponentLifecycleInterface = nosliw.getNodeData("component.getComponentLifecycleInterface");
	var node_createAppDecoration = nosliw.getNodeData("uiapp.createAppDecoration");

	
    // Our initialization code here
	var currentSearchString = window.location.search;
	var appEntryId = currentSearchString.substring(currentSearchString.indexOf("=")+1);

	var configure = {
		global : {
			appDecoration : [
				{
					coreFun: node_createAppDecoration,
					id : "application"
				}
				],
			__appDataService : node_appDataService,
			__storeService :{
				saveData : function(categary, id, data){
					localStorage.setItem(categary+"_"+id, JSON.stringify(data));
				},
				
				retrieveData : function(categary, id){
					return JSON.parse(localStorage.getItem(categary+"_"+id));
				},
				
				clearData : function(categary, id){
					return localStorage.removeItem(categary+"_"+id);
				}
			},
			app : new Framework7({
				  // App root element
				  root: $("#appDiv").get(),
				  name: 'My App',
				  id: 'com.myapp.test',
				  panel: {
					    swipe: 'both',
				  },		
			}),
		},
		components : {
			application : {
				"components" : {
					"application" : {
						global : {
							"root" : $('#appModuleDiv').get(),
							"decoration" : {
								global : ["Decoration_application_framework7"]
							},
							"moduleDecoration" : ["base", "uidecoration", "application_framework7_mobile"]
						}
					},
					"setting" : {
						global : {
							"root" : $('#settingModuleDiv').get(),
							"decoration" : {
								global : ["Decoration_setting_framework7"]
							},
							"moduleDecoration" : ["base", "uidecoration", "setting_framework7_mobile"]
						},
					}
				}
				
			}
			
		}
	};
	
	//create module runtime
	nosliw.runtime.getUIAppService().executeGetUIAppEntryRuntimeRequest(appEntryId, appEntryId, configure, undefined,
		{
			success : function(requestInfo, uiAppRuntime){
				node_getComponentLifecycleInterface(uiAppRuntime).active();
				
				document.getElementById("appContext").addEventListener("click", function(event){
					event.preventDefault();
					var r = uiAppRuntime.getContextRequest({
						success : function(request, contextData){
							$("#debug").val(JSON.stringify(contextData, null, 4));
						}
					});
					node_requestServiceProcessor.processRequest(r);
				});

				document.getElementById("settingModuleContext").addEventListener("click", function(event){
					event.preventDefault();
					var module = uiAppRuntime.getPart("module.setting");
					var r = module.getContextRequest({
						success : function(request, contextData){
							$("#debug").val(JSON.stringify(contextData, null, 4));
						}
					});
					node_requestServiceProcessor.processRequest(r);
				});

				document.getElementById("appModuleContext").addEventListener("click", function(event){
					event.preventDefault();
					var module = uiAppRuntime.getPart("module.application");
					var r = module.getContextRequest({
						success : function(request, contextData){
							$("#debug").val(JSON.stringify(contextData, null, 4));
						}
					});
					node_requestServiceProcessor.processRequest(r);
				});
			}
		}
	);

});

nosliw.init();
</script>

</html>
